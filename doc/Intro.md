PrimalSpecでの形式仕様記述駆動開発
===================================

この文書について
-----------------

* 目標:本ドキュメントを読んだ人が以下の２つを出来るようになること
    * ソフトウェアの仕様を記述すべきかどうか議論出来る
    * ソフトウェアの仕様をどのように記述すべきか議論出来る


なぜ、設計・実装前に仕様を書くのか？
--------------------------------------

Karl E. Wiegers の "ソフトウェア要求" という本の第一章では設計・開発前に要求や仕様について記述するメリットについて分かりやすく説明しています。
例えば以下のようなメリットが挙がっています。

1. 開発期間の短縮
    * 要求・仕様レベルの間違いによる大幅な手戻りが発生するリスクを軽減
    * 不必要な機能を実装するリスクを軽減
2. 見積り精度の向上
    * 何を作るかの曖昧さが減る程、見積もりの不確実性も減る
3. 顧客とチームメンバーの満足度の向上
    * 期待していたものと異なるとクレームがくる、といったリスクを軽減する
    * 何を作るべきかについてチームや顧客と合意が取れていると安心して開発が出来る


個人的な開発経験を踏まえると、メリットは他にもあります。

* 開発と並行して仕様からテスト計画を作れる
* 仕様変更の影響度合いについて把握しやすい


仕様とは何か？どうやって仕様を記述するのか？
--------------------------------------------

そもそも仕様とは何でしょうか？ここでは単に利用者がシステムに期待する観測可能な振る舞いを表現したモデルを仕様と呼びます。


J.Fitzgerald の "ソフトウェア開発のモデル化技法" の第一章では、システムをモデル化する利点として以下を挙げています。

* 開発の初期段階で誤りを検出し、設計の確信度を高めることが出来る(抽象化と厳密性)
* 客観的かつ機械的な評価が可能である


では、システムのモデルとして何を利用するべきでしょうか？
これについてはケースバイケースです。対象とする処理や評価・検証したい内容によって変わるでしょう。
PrimalSpecではシンプルかつ馴染み深い状態遷移モデルを記述することを想定しています。


モデルを用意したら、そのモデルを記述するのにふさわしい図や言語を用いるべきでしょう。
状態遷移モデルといえば状態遷移図なのですが、規模が大きくなると記述が大変になったり読み辛くなったります。
そこでPrimalSpecではCSPをベースにしたHaskell eDSLを使っています。


システムに対する全ての要求や制約をモデルで表現出来るとは限りません。複数のモデルを使ったり、場合によっては自然言語で記述せざるを得ない場合もあると思います。
自然言語は母国語であれば学習コストなしに読めるというメリットがありますが、厳密性を損なわずに記述する/チェックする手間は大きく、複数人で記述する場合は口調や用語の統一等も大変なので注意が必要です。



記述した内容は適切か？
--------------------------------------------

仕様はただ記述するだけでは意味がありません。記述した仕様がシステムが解くべき課題を解決しうるかどうかを評価する(妥当性検証, validation)必要があります。
これを行う為に、仕様には必ず製品コンセプト、解決したい課題についても記述すべきでしょう。
また、ツールによってはシステムの外部(問題ドメイン)についてもモデル化し、それらの相互作用を記述することで評価出来る場合もあります。


PrimalSpecの書き方
-------------------

* PrimalSpecの書き方については [README.md](https://github.com/yksym/primalspec/blob/master/README.md) を参照
* Haskellについては [IntroductionforCProgrammer.md](https://github.com/yksym/primalspec/blob/master/doc/IntroForCProgrammer.md) を参照

おわりに
-----------

では、以下について議論しましょう

1. 設計・開発前に仕様は書くべきか？
1. 仕様はどう書くべきか？


余談: 仕様と設計
----------------

J.Fitzgerald は抽象度のレベルによって仕様と設計を呼び分けている様です。
私も文脈によってはこれに倣っています。つまり、設計とは、システムを部品(モジュール)に分割し、(システム全体の仕様を満たすように)その仕様を定める行為といった具合です。
こういった仕様・設計といった言葉の定義については諸説あるようですが、[SWEBOK](http://swebokwiki.org/)の用語定義がシンプルかつ分かりやくてオススメです。


